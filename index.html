<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mystic Path Minigame</title>
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  <style>
    body {
      background:black;
      color:white;
      font-family:"VT323",monospace;
      font-size: clamp(16px,4vw,36px);
      display:flex;
      align-items:center;
      justify-content:center;
      height:100vh;
      margin:0;
      overflow:hidden;
    }

    #game {
      width:90vw;
      height:90vh;
      padding:5vw;
      text-align:center;
      position:relative;
      z-index:2;
    }

    #text {
      white-space:pre-wrap;
      min-height:20vh;
      font-size: clamp(16px,4vw,36px);
      line-height:1.3;
    }

    #choices { margin-top:5vh; }

    .choice {
      margin: 2vw;
      padding: 2vw 4vw;
      border:1px solid white;
      display:inline-block;
      cursor:pointer;
      font-size: clamp(14px,4vw,32px);
      border-radius:8px;
      transition: all 0.2s ease-in-out;
      animation: glow 2s infinite alternate;
    }
    .choice:active {
      transform:scale(1.05);
      box-shadow:0 0 20px white;
    }

    .glow { animation: glow 2s infinite alternate; }
    @keyframes glow {
      from { text-shadow:0 0 4px white; }
      to   { text-shadow:0 0 20px white; }
    }

    .pixel {
      position:absolute;
      width:3px;
      height:3px;
      background:white;
      opacity:0.6;
      z-index:1;
      border-radius:50%;
      animation: twinkle 3s infinite alternate;
    }
    @keyframes twinkle {
      from { opacity:0.2; transform:scale(1); }
      to   { opacity:1; transform:scale(1.5); }
    }

    .symbol {
      font-size: 15vw;
      margin: 20px 0;
      animation: pulse 3s infinite alternate;
    }
    @keyframes pulse {
      from { text-shadow: 0 0 5px white, 0 0 10px white; }
      to   { text-shadow: 0 0 20px white, 0 0 40px white; }
    }

    .result-title { font-size: 6vw; margin: 10px 0; }
    .result-desc { font-size: 4.5vw; margin-top: 10px; line-height: 1.4; }

    @media (max-width:600px) {
      body { font-size:5vw; }
      #text { font-size:5vw; line-height:1.2; }
      .choice { font-size:5vw; padding:3vw 6vw; margin:2vw; }
    }

    #fullscreen-btn {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(255,255,255,0.1);
      border: 1px solid white;
      color: white;
      padding: 6px 12px;
      font-size: 4vw;
      cursor: pointer;
      z-index: 9999;
      border-radius: 6px;
      transition: all 0.2s ease-in-out;
    }
    #fullscreen-btn:hover, #fullscreen-btn:active {
      background: white;
      color: black;
      box-shadow: 0 0 10px white;
    }
  </style>
</head>
<body>
  <button id="fullscreen-btn">‚õ∂</button>
  <div id="game">
    <div id="text"></div>
    <div id="choices"></div>
  </div>
  <script>
  const text=document.getElementById("text");
  const choices=document.getElementById("choices");
  let busy=false,currentPath=[],currentLevel=0;

  const ARCHETYPES = [
    { key:"Stoic Swordsman", title:"‚öî The Stoic Swordsman", symbol:"‚öî",
      desc:"Steel is a mirror of the soul. You sever illusions with clarity and solemn resolve." },
    { key:"Trickster Rogue", title:"üÉè The Trickster Rogue", symbol:"üÉè",
      desc:"Rules are chains. You laugh as you slip them, turning fate into a jest." },
    { key:"Loyal Protector", title:"üõ° The Loyal Protector", symbol:"üõ°",
      desc:"Your heart is both flame and shield. You endure so others may stand." },
    { key:"Eternal Scholar", title:"üìú The Eternal Scholar", symbol:"üìú",
      desc:"The halls of truth have no end. You wander them eternally, hungering for wisdom." },
    { key:"Shadow Wanderer", title:"üåë The Shadow Wanderer", symbol:"üåë",
      desc:"You walk unseen, carrying silence and scars as companions." },
    { key:"Burning Hero", title:"üî• The Burning Hero", symbol:"üî•",
      desc:"Passion blazes in you. Even gods cannot snuff your fire." },
    { key:"Silent Oracle", title:"üîÆ The Silent Oracle", symbol:"üîÆ",
      desc:"You perceive the whispers between moments. Your silence speaks louder than prophecy." },
    { key:"Cosmic Dreamer", title:"üåå The Cosmic Dreamer", symbol:"üåå",
      desc:"Worlds bloom from your thoughts. You shape infinity with your visions." }
  ];

  const QUESTIONS=[
    ["Four roads stretch before you ‚Äî which stirs your soul?","Strength","Wisdom","Loyalty","Dreams"],
    ["Steel or shadow, which do you trust more?","Blade","Hidden paths","Shared oath","Cosmic vision"],
    ["The night whispers ‚Äî do you seek?","Clarity","Mysteries","Companions","Infinite skies"],
    ["Before battle, what heart do you carry?","Resolve","Cunning","Sacrifice","Imagination"],
    ["The final step reveals your essence ‚Äî what guides you?","Discipline","Freedom","Devotion","Transcendence"]
  ];

  // Map choices to archetype indices for deterministic paths
  const CHOICE_TO_ARCHETYPE = [
    [0,3,2,7], // question 0
    [0,4,2,7], // question 1
    [0,4,2,7], // question 2
    [0,1,2,7], // question 3
    [0,1,2,7]  // question 4
  ];

  function typeText(str,cb){
    busy=true;text.innerHTML="";
    let i=0;
    function step(){
      if(i<str.length){text.innerHTML+=str[i++];setTimeout(step,30);}
      else{busy=false;if(cb)cb();}
    }
    step();
  }
  function clearChoices(){choices.innerHTML="";}

  function showChoices(opts){
    clearChoices();
    opts.forEach((o,i)=>{
      const div=document.createElement("div");
      div.className="choice glow";
      div.textContent=o;
      div.onclick=()=>{ if(!busy) handleChoice(i,o); };
      choices.appendChild(div);
    });
  }

  function handleChoice(i,label){
    if(currentLevel===0 && label.startsWith("No")){
      clearChoices();
      typeText("‚ö° The connection severs. The path remains closed.\n\n(Refresh to try again.)");
      return;
    }
    if(currentLevel===0 && label.startsWith("Yes")){
      currentPath.push(i);currentLevel=0;navigate();return;
    }
    if(label.startsWith("Restart")){
      startGame();
      return;
    }
    if(label.startsWith("End")){
      clearChoices();
      typeText("üåô The journey sleeps, until another soul awakens it.");
      return;
    }

    currentPath.push(i);currentLevel++;
    if(currentLevel>=QUESTIONS.length) finish();
    else navigate();
  }

  function navigate(){
    clearChoices();
    const q=QUESTIONS[currentLevel];
    typeText(q[0],()=>showChoices(q.slice(1)));
  }

  function finish(){
    // Sum the mapped choice indices to determine archetype
    let sumIndex=0;
    for(let lvl=0; lvl<currentPath.length; lvl++){
      sumIndex += CHOICE_TO_ARCHETYPE[lvl][currentPath[lvl]];
    }
    const archetype = ARCHETYPES[sumIndex % ARCHETYPES.length];

    clearChoices();
    text.innerHTML = ""; 

    const symbolDiv = document.createElement("div");
    symbolDiv.className = "symbol glow";
    symbolDiv.textContent = archetype.symbol;
    text.appendChild(symbolDiv);

    setTimeout(() => {
      const titleDiv = document.createElement("div");
      titleDiv.className = "result-title glow";
      titleDiv.textContent = "‚ú® " + archetype.title + " ‚ú®";
      text.appendChild(titleDiv);

      setTimeout(() => {
        const descDiv = document.createElement("div");
        descDiv.className = "result-desc";
        descDiv.textContent = archetype.desc;
        text.appendChild(descDiv);

        setTimeout(() => {
          showChoices(["Restart the journey","End"]);
        }, 1000);
      }, 1000);
    }, 1000);
  }

  function startGame(){
    currentPath=[];currentLevel=0;
    const intro="üì≤ A message flickers to life...\n\nA presence asks, with patience carved in centuries:\n\n'Do you dare to tread the path of fivefold questions?'";
    typeText(intro,()=>showChoices([
      "Yes ‚Äî I step forth.",
      "No ‚Äî I turn away."
    ]));
  }

  (function spawnPixels(){
    for(let i=0;i<120;i++){
      const p=document.createElement("div");
      p.className="pixel";
      p.style.left=Math.random()*100+"vw";
      p.style.top=Math.random()*100+"vh";
      p.style.animationDuration=(2+Math.random()*4)+"s";
      p.style.animationDelay=(Math.random()*5)+"s";
      document.body.appendChild(p);
    }
  })();

  startGame();

  // Fullscreen toggle
  const fsBtn=document.getElementById("fullscreen-btn");
  fsBtn.addEventListener("click",()=>{
    if(!document.fullscreenElement){
      document.documentElement.requestFullscreen().catch(err=>{
        alert(`Error: ${err.message}`);
      });
    } else {
      document.exitFullscreen();
    }
  });
  </script>
</body>
</html>
